(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-09a93b6e"],{"3f14":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Card",{attrs:{"dis-hover":""}},[r("p",{attrs:{slot:"title"},slot:"title"},[e._v("Groups")]),r("Table",{staticClass:"content-table",attrs:{loading:e.tableLoading,columns:e.groupColumns,data:e.groups,"no-data-text":""},on:{"on-sort-change":e.onSort},scopedSlots:e._u([{key:"time",fn:function(t){var o=t.row;return[r("Time",{attrs:{time:e._f("parseInt")(o.gmtCreate),type:"datetime"}})]}},{key:"owner",fn:function(t){var o=t.row;return[r("span",[e._v(e._s(o.owner.username+"("+o.owner.nickname+")"))])]}},{key:"openness",fn:function(t){var o=t.row;return[r("span",[e._v(e._s(e.GROUP_OPENNESS[o.openness].title))])]}},{key:"edit",fn:function(t){var o=t.row;return[r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.onEditGroup(o.groupId,"edit")}}},[e._v("Edit")]),r("Divider",{attrs:{type:"vertical"}}),r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.onEditGroup(o.groupId,"member")}}},[e._v("Members")]),r("Divider",{attrs:{type:"vertical"}}),r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.onDeleteGroup(o)}}},[e._v("Delete")])]}}])})],1),r("div",{staticClass:"footer-tools"},[r("Button",{staticClass:"float-left footer-btn",attrs:{type:"default",size:"small"},on:{click:e.onCreateGroup}},[e._v("Create")]),r("Page",{staticClass:"float-right",attrs:{size:"small","show-elevator":"","show-sizer":"",total:e.total,current:e.pageNow,"page-size":e.pageSize,"page-size-opts":e.pageSizeOpts},on:{"update:current":function(t){e.pageNow=t},"on-change":e.onPageChange,"on-page-size-change":e.onPageSizeChange}})],1),r("Modal",{attrs:{width:"80%",loading:e.groupModalLoading,"mask-closable":!1,title:e.addGroup?"Add Group":"Edit Group "+e.group.title+" (Group ID: "+e.group.groupId+")"},on:{"on-ok":e.updateGroup},model:{value:e.groupModal,callback:function(t){e.groupModal=t},expression:"groupModal"}},[r("Form",{ref:"group",attrs:{model:e.group,"label-position":"top",rules:e.groupValidate}},[r("FormItem",{attrs:{label:"Title",prop:"title"}},[r("Input",{model:{value:e.group.title,callback:function(t){e.$set(e.group,"title",t)},expression:"group.title"}})],1),r("FormItem",{attrs:{label:"Description"}},[r("Input",{model:{value:e.group.description,callback:function(t){e.$set(e.group,"description",t)},expression:"group.description"}})],1),r("FormItem",{attrs:{label:"Openness",required:""}},[r("RadioGroup",{attrs:{vertical:""},model:{value:e.group.openness,callback:function(t){e.$set(e.group,"openness",t)},expression:"group.openness"}},e._l(e.GROUP_OPENNESS_TYPE,(function(t){return r("Radio",{key:t,attrs:{label:t}},[e._v(" "+e._s(e.GROUP_OPENNESS[t].title+": "+e.GROUP_OPENNESS[t].description)+" ")])})),1)],1),r("FormItem",{attrs:{label:"Markdown"}},[r("MarkdownEditor",{ref:"md"})],1)],1)],1),r("Modal",{attrs:{width:"80%",title:"Members in "+e.group.title+" (Group ID: "+e.group.groupId+")"},model:{value:e.memberModal,callback:function(t){e.memberModal=t},expression:"memberModal"}},[e.applyMembers.length>0?r("div",[r("Alert",[r("span",{staticStyle:{"margin-right":"16px"}},[e._v("Apply List ("+e._s(e.applyMembers.length)+")")]),r("Button",{attrs:{size:"small"},on:{click:function(t){return e.acceptMembers(e.applyMembers,1)}}},[e._v("Accept All")]),r("Divider",{attrs:{type:"vertical"}}),r("Button",{attrs:{type:"warning",size:"small"},on:{click:function(t){return e.rejectMembers(e.applyMembers,1)}}},[e._v("Reject All")])],1),r("Table",{staticClass:"content-table",attrs:{columns:e.memberColumns,data:e.applyMembers,"max-height":500,"no-data-text":""},scopedSlots:e._u([{key:"edit",fn:function(t){var o=t.row;return[r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.acceptMembers(o,0)}}},[e._v("Accept")]),r("Divider",{attrs:{type:"vertical"}}),r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.rejectMembers(o,0)}}},[e._v("Reject")])]}}],null,!1,3031023699)})],1):e._e(),e.allMembers.length>0&&e.applyMembers.length>0?r("Divider"):e._e(),e.allMembers.length>0?r("div",[r("Alert",{attrs:{type:"success"}},[r("div",[r("span",{staticStyle:{"margin-right":"16px"}},[e._v("Member List ("+e._s(e.allMembers.length)+")")]),r("Button",{attrs:{size:"small"},on:{click:function(t){e.addMembersInput=!e.addMembersInput}}},[e._v("Add Members")]),r("Divider",{attrs:{type:"vertical"}}),e.allMembersWithoutOwner.length>0?r("Button",{attrs:{type:"warning",size:"small"},on:{click:function(t){return e.rejectMembers(e.allMembers,1)}}},[e._v("Remove All")]):e._e()],1),e.addMembersInput?r("div",{staticStyle:{"margin-top":"8px"}},[r("span",{staticStyle:{color:"#808695"}},[e._v("Separate username by a TAB '\\t', SPACE ' ', NEW LINE '\\n' or COMMA ','")]),r("Input",{staticStyle:{margin:"5px 0"},attrs:{type:"textarea",autosize:{minRows:3}},model:{value:e.membersAdd,callback:function(t){e.membersAdd=t},expression:"membersAdd"}}),r("Button",{attrs:{size:"small",type:"info"},on:{click:e.addMembers2Group}},[e._v("Add")])],1):e._e()]),r("Table",{staticClass:"content-table",attrs:{columns:e.memberColumns,data:e.allMembers,"max-height":500,"no-data-text":""},scopedSlots:e._u([{key:"edit",fn:function(t){var o=t.row;return[o.userId!==e.group.owner.userId?r("div",[r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.rejectMembers(o,0)}}},[e._v("Remove")]),r("Divider",{attrs:{type:"vertical"}}),r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.transferOwner(e.group,o)}}},[e._v("Transfer")])],1):e._e()]}}],null,!1,2309735810)})],1):e._e()],1)],1)},n=[],a=(r("a4d3"),r("e01a"),r("99af"),r("4de4"),r("d81d"),r("d3b7"),r("ac1f"),r("25f0"),r("1276"),r("7c15")),s=r("c9d9"),i=r("e325"),u=r("fa70"),l={name:"GroupListView",mixins:[i["b"]],components:{MarkdownEditor:u["a"]},filters:{parseInt:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return parseInt(e)}))},data:function(){return{groups:[],groupColumns:[{key:"groupId",maxWidth:80},{title:"Create Time",slot:"time"},{title:"Title",key:"title"},{title:"Description",key:"description"},{title:"Owner",slot:"owner"},{title:"Openness",slot:"openness"},{title:"Members",key:"memberNum"},{title:"\b",slot:"edit",width:200}],memberColumns:[{key:"userId",maxWidth:80},{title:"Username",key:"username"},{title:"Nickname",key:"nickname"},{title:"Email",key:"email"},{title:"\b",slot:"edit",width:200}],groupValidate:{title:[{required:!0,message:"The title cannot be empty",trigger:"blur"}]},group:{groupId:"",title:"",description:"",openness:0,markdown:"",members:[]},groupModalLoading:!0,groupModal:!1,addGroup:!0,memberModal:!1,tableLoading:!1,addMembersInput:!1,membersAdd:""}},methods:{getGroupList:function(){var e=this;this.tableLoading=!0,a["a"].getGroupList({pageNow:this.pageNow,pageSize:this.pageSize}).then((function(t){e.groups=t.rows,e.total=parseInt(t.totalPage)*e.pageSize})).catch((function(t){e.$Message.error(t.message)})).finally((function(){e.tableLoading=!1}))},updateGroup:function(){var e=this;this.group.markdown=this.$refs.md.getMarkdown(),this.$refs.group.validate((function(t){if(t){var r=e.addGroup?"createGroup":"updateGroup";a["a"][r](e.group).then((function(t){e.$Message.success("Success"),e.getGroupList(),e.groupModal=!1})).catch((function(t){e.$Message.error(t.message),e.groupModalLoading=!1,e.$nextTick((function(){e.groupModalLoading=!0}))}))}}))},onCreateGroup:function(){this.clear(),this.addGroup=!0,this.groupModal=!0},onEditGroup:function(e,t){var r=this,o=this.$Message.loading({content:"Loading",duration:0});a["a"].getGroupDetail({groupId:e}).then((function(e){r.group=e,"edit"===t?(r.$refs.md.setMarkdown(r.group.markdown),r.addGroup=!1,r.groupModal=!0):"member"===t&&(r.addMembersInput=!1,r.membersAdd="",r.memberModal=!0)})).catch((function(e){r.$Message.error(e.message)})).finally((function(){o()}))},onDeleteGroup:function(e){var t=this;this.$Modal.confirm({title:"Confirm to delete",content:"Do you want to delete group ".concat(e.title," (Group ID ").concat(e.groupId,")?"),loading:!0,onOk:function(){e.memberNum>1?(t.$Message.error("You must remove ALL members before deleting the group!"),t.$Modal.remove()):a["a"].deleteGroup({groupId:e.groupId}).then((function(e){t.$Message.success("Success"),t.getGroupList()})).catch((function(e){t.$Message.error(e.message)})).finally((function(){t.$Modal.remove()}))}})},clear:function(){this.group.title="",this.group.description="",this.group.markdown="",this.group.openness=s["d"].PUBLIC,this.$refs.md.$clear(),this.$refs.md.setMarkdown("")},acceptMembers:function(e,t){var r=this;if(t)var o=e.map((function(e){return e.userId})),n="Accept all ".concat(o.length," members?");else o=[e.userId],n="Accept ".concat(e.username," ?");this.$Modal.confirm({title:"Confirm",content:n,loading:!0,onOk:function(){r.updateUserStatus(r.group.groupId,o,s["e"].JOINED).finally((function(){r.$Modal.remove()}))}})},rejectMembers:function(e,t){var r=this;if(t)var o=e.map((function(e){return e.userId})),n="Reject all ".concat(o.length," members?");else o=[e.userId],n="Reject ".concat(e.username," ?");this.$Modal.confirm({title:"Confirm",content:n,loading:!0,onOk:function(){r.updateUserStatus(r.group.groupId,o,s["e"].REJECTED).finally((function(){r.$Modal.remove()}))}})},updateUserStatus:function(e,t,r){var o=this;return new Promise((function(n,s){a["a"].updateUserStatus({groupId:e,userIds:t,status:r}).then((function(t){o.$Message.success("Success"),o.onEditGroup(e),n(t)})).catch((function(e){o.$Message.error(e.message),s(e)}))}))},transferOwner:function(e,t){var r=this;this.$Modal.confirm({title:"Confirm",content:"Transfer the owner of group ".concat(e.title," to ").concat(t.username," ?"),loading:!0,onOk:function(){a["a"].updateGroup({groupId:e.groupId,userId:t.userId}).then((function(t){r.$Message.success("Success"),r.onEditGroup(e.groupId)})).catch((function(e){r.$Message.error(e.message)}))}})},addMembers2Group:function(){var e=this,t=this.$Message.loading({content:"Updating",duration:0});a["a"].addUsersToGroup({groupId:this.group.groupId,usernames:this.membersAdd.split(/[\s,]+/),status:s["e"].JOINED}).then((function(t){e.$Message.success("Success"),e.membersAdd="",e.onEditGroup(e.group.groupId)})).catch((function(t){e.$Message.error(t.message)})).finally((function(){t()}))}},computed:{applyMembers:function(){return this.group.members.filter((function(e){return e.status===s["e"].APPLIED}))},allMembers:function(){return this.group.members.filter((function(e){return e.status===s["e"].JOINED}))},allMembersWithoutOwner:function(){var e=this;return this.allMembers.filter((function(t){return t.userId!==e.group.owner.userId}))},GROUP_OPENNESS:function(){return s["c"]},GROUP_OPENNESS_TYPE:function(){return s["d"]}},mounted:function(){this.getGroupList()},watch:{$route:function(){this.getGroupList()}}},c=l,p=r("2877"),d=Object(p["a"])(c,o,n,!1,null,"0b15db6c",null);t["default"]=d.exports},e01a:function(e,t,r){"use strict";var o=r("23e7"),n=r("83ab"),a=r("da84"),s=r("5135"),i=r("861d"),u=r("9bf2").f,l=r("e893"),c=a.Symbol;if(n&&"function"==typeof c&&(!("description"in c.prototype)||void 0!==c().description)){var p={},d=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof d?new c(e):void 0===e?c():c(e);return""===e&&(p[t]=!0),t};l(d,c);var m=d.prototype=c.prototype;m.constructor=d;var g=m.toString,f="Symbol(test)"==String(c("test")),b=/^Symbol\((.*)\)[^)]+$/;u(m,"description",{configurable:!0,get:function(){var e=i(this)?this.valueOf():this,t=g.call(e);if(s(p,e))return"";var r=f?t.slice(7,-1):t.replace(b,"$1");return""===r?void 0:r}}),o({global:!0,forced:!0},{Symbol:d})}}}]);
//# sourceMappingURL=chunk-09a93b6e.8b337b7e.js.map